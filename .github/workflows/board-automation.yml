name: Project Board Automation - Pyrsia Develop

on:
  issues:
    types: [created, reopend, labeled]
  project_card:
    types: [moved]

jobs:
  triage-new-issues:
    runs-on: ubuntu-latest
    if: |
      github.event_name == 'issues' &&
      github.event.action == 'created' && github.event.action == 'reopend'
    steps:
      - uses: actions-ecosystem/action-add-labels@v1
        with:
          labels: triage
      - uses: alex-page/github-project-automation-plus@v0.8.1
        with:
          project: Pyrsia Develop
          column: Backlog for them Demo
          repo-token: ${{ secrets.GITHUB_TOKEN }}
    
  label-blocked:
    runs-on: ubuntu-latest
    if: github.event_name == 'issues' && github.event.action == 'labeled' && github.event.label.name == 'blocked'
    steps:
      - uses: alex-page/github-project-automation-plus@v0.8.1
        with:
          project: Pyrsia Develop
          column: Blocked
          repo-token: ${{ secrets.GITHUB_TOKEN }}
  
  move-to-blocked:
    runs-on: ubuntu-latest
    # Blocked column ID --> https://github.com/orgs/pyrsia/projects/2#column-16583791
    if: |
      github.event_name == 'project_card' && github.event.action == 'moved' &&
      github.event.project_card.column_id == '16583791'
    steps:
      - uses: andymckay/labeler@1.0.4
        with:
          add-labels: blocked
